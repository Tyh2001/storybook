import{_ as s,o as n,c as a,a as l}from"./app.cfc06717.js";const A=JSON.parse('{"title":"å…³äºå›¾ç‰‡åŠ è½½ï¼Œä½ éœ€è¦å­¦ä¹ ä¸€ä¸‹","description":"","frontmatter":{},"headers":[{"level":2,"title":"ğŸ‘‹ Hello","slug":"ğŸ‘‹-hello","link":"#ğŸ‘‹-hello","children":[]},{"level":2,"title":"ğŸ˜Š ä»ä½•è€Œæ¥","slug":"ğŸ˜Š-ä»ä½•è€Œæ¥","link":"#ğŸ˜Š-ä»ä½•è€Œæ¥","children":[]},{"level":2,"title":"ğŸ¥• è®¾è®¡æ€è·¯","slug":"ğŸ¥•-è®¾è®¡æ€è·¯","link":"#ğŸ¥•-è®¾è®¡æ€è·¯","children":[]},{"level":2,"title":"ğŸ­ åˆæ­¥è®¾è®¡","slug":"ğŸ­-åˆæ­¥è®¾è®¡","link":"#ğŸ­-åˆæ­¥è®¾è®¡","children":[]},{"level":2,"title":"ğŸš© æˆåŠŸå’Œå¤±è´¥","slug":"ğŸš©-æˆåŠŸå’Œå¤±è´¥","link":"#ğŸš©-æˆåŠŸå’Œå¤±è´¥","children":[]},{"level":2,"title":"ğŸš§ åŠ è½½å¤±è´¥","slug":"ğŸš§-åŠ è½½å¤±è´¥","link":"#ğŸš§-åŠ è½½å¤±è´¥","children":[]},{"level":2,"title":"ğŸ¬ å›è°ƒå‡½æ•°","slug":"ğŸ¬-å›è°ƒå‡½æ•°","link":"#ğŸ¬-å›è°ƒå‡½æ•°","children":[]},{"level":2,"title":"âŒ› æ‡’åŠ è½½","slug":"âŒ›-æ‡’åŠ è½½","link":"#âŒ›-æ‡’åŠ è½½","children":[]},{"level":2,"title":"ğŸš¥ å¯¹å¤–æ¥å£","slug":"ğŸš¥-å¯¹å¤–æ¥å£","link":"#ğŸš¥-å¯¹å¤–æ¥å£","children":[]},{"level":2,"title":"ğŸ† å®Œæ•´ä»£ç ","slug":"ğŸ†-å®Œæ•´ä»£ç ","link":"#ğŸ†-å®Œæ•´ä»£ç ","children":[]},{"level":2,"title":"ğŸ’ª å†™åœ¨æœ€å","slug":"ğŸ’ª-å†™åœ¨æœ€å","link":"#ğŸ’ª-å†™åœ¨æœ€å","children":[]}],"relativePath":"article/article/article-16.md"}'),p={name:"article/article/article-16.md"},o=l(`<h1 id="å…³äºå›¾ç‰‡åŠ è½½-ä½ éœ€è¦å­¦ä¹ ä¸€ä¸‹" tabindex="-1">å…³äºå›¾ç‰‡åŠ è½½ï¼Œä½ éœ€è¦å­¦ä¹ ä¸€ä¸‹ <a class="header-anchor" href="#å…³äºå›¾ç‰‡åŠ è½½-ä½ éœ€è¦å­¦ä¹ ä¸€ä¸‹" aria-hidden="true">#</a></h1><h2 id="ğŸ‘‹-hello" tabindex="-1">ğŸ‘‹ Hello <a class="header-anchor" href="#ğŸ‘‹-hello" aria-hidden="true">#</a></h2><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯<a href="https://github.com/Tyh2001" target="_blank" rel="noreferrer">ç”°åŒå­¦</a>ï¼Œå¤§å®¶å¯ä»¥åŠ æˆ‘å¾®ä¿¡ <code>VirgoTyh</code> ä¸€èµ·å…±åŒå­¦ä¹ ã€‚</p><h2 id="ğŸ˜Š-ä»ä½•è€Œæ¥" tabindex="-1">ğŸ˜Š ä»ä½•è€Œæ¥ <a class="header-anchor" href="#ğŸ˜Š-ä»ä½•è€Œæ¥" aria-hidden="true">#</a></h2><p>è¿™ç¯‡æ–‡ç« ï¼Œå‡ºè‡ªæˆ‘è‡ªå·±çš„å¼€æºç»„ä»¶åº“ <a href="https://github.com/FightingDesign/fighting-design" target="_blank" rel="noreferrer">fighting-design</a> ä¸­çš„ <a href="https://fighting.tianyuhao.cn/components/avatar.html" target="_blank" rel="noreferrer">Avatar å¤´åƒ</a> ç»„ä»¶çš„ <a href="https://github.com/FightingDesign/fighting-design/blob/master/packages/fighting-design/_utils/load-image/index.ts" target="_blank" rel="noreferrer">load-image</a> ç±»ã€‚</p><p>ç›¸æ¯”äºå…¶å®ƒçš„é™æ€ç»„ä»¶ï¼Œåƒå›¾ç‰‡åŠ è½½è¿™ç§çš„ç»„ä»¶ï¼Œå†…éƒ¨æˆ‘åšäº†å¾ˆå¤šçš„ä¼˜åŒ–ï¼Œå¯¹äºå›¾ç‰‡çš„åŠ è½½å’Œé”™è¯¯çš„å¤„ç†ï¼Œæˆ‘éƒ½å°½å¯èƒ½çš„å°†æ¯ç§å¯èƒ½å‡ºç°çš„ç»“æœéƒ½è€ƒè™‘åˆ°ï¼Œé’ˆå¯¹æ¯ç§ä¸ç¡®å®šçš„ç»“æœåšå‡ºç›¸åº”çš„æç¤ºï¼Œä»¥ä¾¿äºæå‡ç”¨æˆ·ä½“éªŒã€‚</p><h2 id="ğŸ¥•-è®¾è®¡æ€è·¯" tabindex="-1">ğŸ¥• è®¾è®¡æ€è·¯ <a class="header-anchor" href="#ğŸ¥•-è®¾è®¡æ€è·¯" aria-hidden="true">#</a></h2><p>æˆ‘çš„è®¾è®¡æƒ³æ³•æ˜¯ï¼šé€šè¿‡ä¸€ä¸ªåŠ è½½ç±»ï¼Œä¼ å…¥ <code>dom</code> å…ƒç´ ã€ <code>props</code> å’Œ <code>emit</code>ã€‚å…ˆåˆ›å»ºå‡ºä¸€ä¸ªè™šæ‹Ÿçš„ <code>image</code> å…ƒç´ è¿›è¡Œå°è¯•åŠ è½½ï¼ŒåŠ è½½æˆåŠŸè·å¤±è´¥éƒ½ä¼šè¿›å…¥ä¸‹ä¸€æ­¥çš„å‡½æ•°ï¼Œåšå‡ºå¯¹åº”ä»å¤„ç†é€»è¾‘ã€‚</p><h2 id="ğŸ­-åˆæ­¥è®¾è®¡" tabindex="-1">ğŸ­ åˆæ­¥è®¾è®¡ <a class="header-anchor" href="#ğŸ­-åˆæ­¥è®¾è®¡" aria-hidden="true">#</a></h2><p>é¦–å…ˆç±»ä¸­å…ˆæœ‰ä¸€ä¸ªåŠ è½½çš„æ–¹æ³• <code>loadCreateImg</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Load</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">node</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">props</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">emit</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">props</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">emit</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">emit</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åŠ è½½ src</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">loadCreateImg</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newImg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> Image() </span><span style="color:#676E95;font-style:italic;">// æ–°å»ºä¸€ä¸ªè™šæ‹Ÿçš„ img</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å°†ä¼ å…¥çš„ src èµ‹å€¼ç»™è™šæ‹ŸèŠ‚ç‚¹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// src åŠ è½½å¤±è´¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">addEventListener(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// åŠ è½½å¤±è´¥çš„å¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// src åŠ è½½æˆåŠŸ</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">addEventListener(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// åŠ è½½æˆåŠŸçš„å¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>é¦–å…ˆæˆ‘åˆ›å»ºäº†ä¸€ä¸ª <code>Load</code> çš„åŠ è½½ç±»ï¼Œéœ€è¦ä¼ å…¥ <code>node</code> å‚æ•°ä½œä¸ºæœ€ç»ˆéœ€è¦æ¸²æŸ“çš„ <code>dom</code> èŠ‚ç‚¹ï¼Œ<code>props</code> æ˜¯ä¼ å…¥çš„ç»„ä»¶å†…éƒ¨çš„ <code>props</code> å‚æ•°ï¼Œå†…éƒ¨åŒ…å«å›¾ç‰‡éœ€è¦åŠ è½½çš„ <code>src</code> è·¯å¾„ï¼Œ<code>emit</code> åŒ…æ‹¬ä¸€äº›å›è°ƒå‚æ•°ã€‚</p><p>ç±»çš„å†…éƒ¨æœ‰ä¸ª <code>loadCreateImg</code> çš„æ–¹æ³•ï¼Œè°ƒç”¨å¯åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„ <code>Image</code> å…ƒç´ ï¼Œç›´æ¥å°†ä¼ å…¥çš„ <code>props.src</code> èµ‹å€¼å¹¶åŠ è½½ã€‚ç›‘å¬ä¸Šé¢çš„ <code>error</code> å’Œ <code>load</code> äº‹ä»¶ï¼Œå³å¯ç›‘å¬åˆ°å›¾ç‰‡æ˜¯å¦åŠ è½½æˆåŠŸï¼Œä»¥ä¾¿åšå‡ºä¸åŒçš„çŠ¶æ€ã€‚</p><h2 id="ğŸš©-æˆåŠŸå’Œå¤±è´¥" tabindex="-1">ğŸš© æˆåŠŸå’Œå¤±è´¥ <a class="header-anchor" href="#ğŸš©-æˆåŠŸå’Œå¤±è´¥" aria-hidden="true">#</a></h2><p>å¯¹äºæˆåŠŸæˆ–å¤±è´¥çš„å¤„ç†ï¼Œæˆ‘æ–°å¢äº† <code>onerror</code> å’Œ <code>onload</code> æ–¹æ³•ï¼Œæ¥å¤„ç†åŠ è½½æˆåŠŸå’Œå¤±è´¥ä¹‹åçš„ä¸åŒå¤„ç†çŠ¶æ€</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Load</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">node</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">props</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">emit</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">props</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">emit</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">emit</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">loadCreateImg</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newImg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> Image()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">addEventListener(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">onerror(</span><span style="color:#A6ACCD;">evt</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// æ–°å¢</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">addEventListener(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">onload(</span><span style="color:#A6ACCD;">evt</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// æ–°å¢</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åŠ è½½æˆåŠŸ</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">onload</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åŠ è½½å¤±è´¥</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">onerror</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// â€¦â€¦</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å¯¹äºåŠ è½½æˆåŠŸï¼Œå¤„ç†æ–¹å¼æ˜¯ï¼Œå°†ä¼ å…¥çš„çœŸæ˜¯çš„ <code>dom</code> èŠ‚ç‚¹ç›´æ¥èµ‹å€¼ç»™ä¼ å…¥çš„ <code>props.src</code> å³å¯å®ŒæˆåŠ è½½ã€‚</p><h2 id="ğŸš§-åŠ è½½å¤±è´¥" tabindex="-1">ğŸš§ åŠ è½½å¤±è´¥ <a class="header-anchor" href="#ğŸš§-åŠ è½½å¤±è´¥" aria-hidden="true">#</a></h2><p>å¯¹äºåŠ è½½å¤±è´¥çš„å¤„ç†ï¼Œ<code>Fighting Design</code> å†…éƒ¨åšäº†å¾ˆå¤šå¤„ç†ï¼Œæ¯”å¦‚å¯ä»¥ä¼ å…¥ <code>err-src</code> çš„å¤‡ç”¨è·¯å¾„åŠ è½½ï¼Œåœ¨ <code>src</code> åŠ è½½å¤±è´¥ä¹‹åï¼Œå¦‚æœ <code>err-src</code> å­˜åœ¨çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦åŠ è½½ <code>err-src</code> ã€‚æ¥ä¸‹æ¥ç»§ç»­å®Œå–„ç±»æ–¹æ³•ï¼š</p><p>é¦–å…ˆè¦åœ¨ <code>onerror</code> æ–¹æ³•ä¸­åˆ¤æ–­æ˜¯å¦å­˜åœ¨ <code>err-src</code>ï¼Œå¦‚æœæœ‰ <code>err-src</code> é‚£ä¹ˆå°±éœ€è¦é‡æ–°è°ƒç”¨ <code>loadCreateImg</code> é‡æ–°åŠ è½½ï¼Œä½†æ˜¯ç°åœ¨çš„ä»£ç æ˜¾ç„¶ä¸èƒ½æ»¡è¶³éœ€è¦ï¼Œæ‰€ä»¥ <code>loadCreateImg</code> éœ€è¦æ¥æ”¶ä¸€ä¸ªå¯é€‰çš„å‚æ•°ä¸º <code>errSrc</code>ï¼Œå› ä¸ºåªæœ‰åœ¨åŠ è½½å¤±è´¥ä¹‹åæ‰éœ€è¦å†æ¬¡è°ƒç”¨è¯¥æ–¹æ³•ä¼ å…¥ <code>err-src</code>ï¼Œæ‰€ä»¥æ–¹æ³•å†…éƒ¨å°±å¯ä»¥æ ¹æ® <code>err-src</code> æ˜¯å¦å­˜åœ¨ï¼Œæ¥åšå‡ºä¸åŒçš„å¤„ç†ï¼š</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Load</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">node</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">props</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">emit</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">props</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">emit</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">emit</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">loadCreateImg</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">errSrc</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newImg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> Image()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¦‚æœ errSrc å­˜åœ¨ å°±å°è¯•åŠ è½½ errSrc</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">errSrc</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">errSrc</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">addEventListener(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">onerror(</span><span style="color:#A6ACCD;">evt</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">addEventListener(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">onload(</span><span style="color:#A6ACCD;">evt</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">onload</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åŠ è½½å¤±è´¥</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">onerror</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¦‚æœå­˜åœ¨ errSrc åˆ™ç»§ç»­å°è¯•åŠ è½½</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errSrc</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å°† errSrc ä¼ ç»™ loadCreateImg æ–¹æ³•</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">loadCreateImg(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errSrc</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¦åˆ™è¿”å›å¤±è´¥å›è°ƒ</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">emit(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">evt</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ä½†æ˜¯ä¸Šé¢ä»£ç å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>é¦–å…ˆæˆ‘ä»¬å‘ç°ï¼Œåœ¨ <code>onload</code> åŠ è½½æˆåŠŸçš„æ–¹æ³•ä¸­ï¼Œå°†çœŸå® <code>dom</code> å§‹ç»ˆèµ‹å€¼çš„å§‹ç»ˆ æ˜¯ <code>src</code>ï¼š</li></ol><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">onload</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å§‹ç»ˆèµ‹å€¼ä¸º props.src</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ä½†æ˜¯ <code>src</code> å¹¶ä¸æ˜¯å§‹ç»ˆå¯ä»¥åŠ è½½æˆåŠŸçš„ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦åŠ¨æ€çš„å»å°†çœŸæ­£åŠ è½½æˆåŠŸçš„ <code>src</code> ä¼ ç»™ <code>onload</code> æ–¹æ³•ï¼Œé‚£ä¹ˆçœŸæ­£åŠ è½½æˆåŠŸçš„ <code>src</code> ä¹Ÿå°±æ˜¯åœ¨ <code>load</code> æ–¹æ³•ä¸­ã€‚å¹¶ä¸”è¿˜è¦åŠ å…¥æˆåŠŸçš„ <code>emit</code>ã€‚</p><ol start="2"><li>å…¶æ¬¡ï¼Œåœ¨å¤„ç†åŠ è½½å¤±è´¥çš„ <code>onerror</code> æ–¹æ³•ä¸­ï¼Œå› ä¸ºåˆ¤æ–­äº†å¦‚æœå­˜åœ¨ <code>errSrc</code> å°±ç»§ç»­è°ƒç”¨ <code>loadCreateImg</code> åŠ è½½æ–¹æ³•é‡æ–°åŠ è½½ã€‚é—®é¢˜æ˜¯ï¼Œå¦‚æœä¼ å…¥äº† <code>errSrc</code> é‚£ä¹ˆ <code>if (this.props.errSrc)</code> å…¶å®æ˜¯å§‹ç»ˆä¸ºçœŸçš„ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†æ­»å¾ªç¯ï¼Œä¼šé‡å¤è°ƒç”¨åŠ è½½å‡½æ•°ã€‚</li></ol><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">onerror</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åˆ¤æ–­å§‹ç»ˆä¸ºçœŸ</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errSrc</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">loadCreateImg</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errSrc</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å¦åˆ™è¿”å›å¤±è´¥å›è°ƒ</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">emit</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">evt</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>æ‰€ä»¥å°±éœ€è¦ç»™å®ƒä¸€ä¸ªå¯ä»¥å˜ä¸ºå‡çš„æ—¶æœºï¼Œé‚£ä¹ˆä¿®å¤æ–¹æ³•ä¸ºï¼šæ·»åŠ ä¸€ä¸ªå¸ƒå°”å€¼æ§åˆ¶æ˜¯å¦åŠ è½½äº† <code>errSrc</code>ï¼Œæ‰€ä»¥åœ¨ç±»æ–¹æ³•ä¸­æ·»åŠ äº† <code>loadErrSrc</code> è¿›è¡Œåˆ¤æ–­</p><p>åœ¨ä¼ ç»™ <code>loadCreateImg</code> æ–¹æ³•ä¹‹åï¼Œå°† <code>errSrc</code> æ¸…ç©ºï¼Œè¿™æ ·åŠ è½½ä¸€æ¬¡ä¹‹åå°±å¯ä»¥åˆ¤æ–­ä¸ºå‡äº†ï¼Œæ‰€ä»¥å®Œæ•´ä»£ç ä¸ºï¼š</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Load</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">node</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">props</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">emit</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">props</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">emit</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">emit</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">loadErrSrc</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">loadCreateImg</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">errSrc</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newImg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> Image()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¦‚æœ errSrc å­˜åœ¨ å°±å°è¯•åŠ è½½ errSrc</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">errSrc</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">errSrc</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">addEventListener(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">onerror(</span><span style="color:#A6ACCD;">evt</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">addEventListener(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">onload(</span><span style="color:#A6ACCD;">evt</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// å°†åŠ è½½æˆåŠŸçš„ src ä¼ ç»™ onload å‡½æ•°</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ–°å¢ src å±æ€§</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">onload</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">src</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å°†çœŸå® dom çš„ src èµ‹å€¼ç»™ä¼ å…¥çš„ src</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">emit(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">evt</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// æ–°å¢</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">onerror</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errSrc</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!this.</span><span style="color:#A6ACCD;">loadErrSrc</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">loadCreateImg(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errSrc</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">loadErrSrc</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">emit(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">evt</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="ğŸ¬-å›è°ƒå‡½æ•°" tabindex="-1">ğŸ¬ å›è°ƒå‡½æ•° <a class="header-anchor" href="#ğŸ¬-å›è°ƒå‡½æ•°" aria-hidden="true">#</a></h2><p>æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡ä¸€ä¸ªå¸ƒå°”å€¼æ¥åˆ¤æ–­å›¾ç‰‡æ˜¯å¦åŠ è½½æˆåŠŸï¼Œæˆ–è€…è¿›è¡Œå…¶å®ƒåˆ¤æ–­ã€‚</p><p><code>Fighting Design</code> å†…éƒ¨å¯¹å›¾ç‰‡åŠ è½½å¤±è´¥åšäº†ç‰¹æ®Šçš„æ ·å¼å¤„ç†æ¥æç¤ºç”¨æˆ·ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå¸ƒå°”å€¼å’Œ <code>v-if</code> æ¥å±•ç¤ºä¸åŒçš„çŠ¶æ€ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°äº†ç±»çš„ç¬¬å››ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¯é€‰çš„å›è°ƒå‡½æ•°</p><p>è¿™æ ·å°±å¯ä»¥åœ¨åŠ è½½æˆåŠŸå’ŒåŠ è½½å¤±è´¥çš„æ—¶å€™é€šè¿‡å›è°ƒå‡½æ•°æ¥è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼åˆ¤æ–­æ˜¯å¦åŠ è½½æˆåŠŸï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Load</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">node</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">props</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">emit</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">callback</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">props</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">emit</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">emit</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">callback</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">callback</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æ–°å¢ callback å‚æ•°</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">loadCreateImg</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">errSrc</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newImg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> Image()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">errSrc</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">errSrc</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">addEventListener(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">onerror(</span><span style="color:#A6ACCD;">evt</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">addEventListener(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">onload(</span><span style="color:#A6ACCD;">evt</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newImg</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">onload</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">src</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">src</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">emit(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">evt</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¦‚æœ callback å­˜åœ¨ï¼Œåœ¨åŠ è½½æˆåŠŸçš„æ—¶å€™è¿”å› true</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">callback</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">callback(</span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">onerror</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">evt</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errSrc</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">loadCreateImg(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errSrc</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errSrc</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">emit(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">evt</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¦‚æœ callback å­˜åœ¨ï¼Œåœ¨åŠ è½½å¤±è´¥çš„æ—¶å€™è¿”å› false</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">callback</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">callback(</span><span style="color:#FF9CAC;">false</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ä¸Šé¢ä»£ç å³å¯å®ç°åˆ¤æ–­æ˜¯å¦åŠ è½½æˆåŠŸçš„éœ€æ±‚ã€‚</p><p>å½“ç„¶ï¼Œå›è°ƒå‡½æ•°ä½ å¯ä»¥å°½æƒ…çš„å‘æŒ¥æƒ³è±¡åšå‡ºæ›´å¤šçš„äº‹æƒ…ï¼Œè¿™é‡Œä»…æä¾›éƒ¨åˆ†ç”¨æ³•ã€‚</p><h2 id="âŒ›-æ‡’åŠ è½½" tabindex="-1">âŒ› æ‡’åŠ è½½ <a class="header-anchor" href="#âŒ›-æ‡’åŠ è½½" aria-hidden="true">#</a></h2><p>å›¾ç‰‡çš„æ‡’åŠ è½½ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå›¾ç‰‡åŠ è½½å¿…å¤‡çš„åŠŸèƒ½äº†ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯å†…ç½®çš„ <a href="https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver" target="_blank" rel="noreferrer">IntersectionObserver</a> æ¥å£ï¼Œå¯¹äºè¿™ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œä¸è¿‡å¤šæè¿°ï¼Œå„ä½å¯ä»¥é€šè¿‡ <a href="https://developer.mozilla.org/zh-CN/" target="_blank" rel="noreferrer">MDN</a> è¿›è¡Œå­¦ä¹ ã€‚</p><p>å¯¹äºæ‡’åŠ è½½ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å±æ€§ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡éƒ½éœ€è¦ï¼Œæ‰€ä»¥æˆ‘å°†æ‡’åŠ è½½å•ç‹¬æŠ½ç¦»å‡ºæ¥çš„ä¸€ä¸ª <code>Lazy</code> ç±»è¿›è¡Œå®ç°ï¼Œå†å°† <code>Lazy</code> ç±»ç»§æ‰¿åˆ° <code>Load</code> ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Lazy</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Load</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">img</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">props</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">emit</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">callback</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// super å…³é”®å­—è°ƒç”¨</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">super</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">img</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">emit</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">callback</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">observer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">observer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> IntersectionObserver(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">arr</span><span style="color:#89DDFF;">):</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">void</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// å¦‚æœè¿›å…¥å¯è§†åŒºåŸŸ</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">arr</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">isIntersecting</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">// å¼€å§‹åŠ è½½å›¾ç‰‡ è°ƒç”¨çˆ¶ç±»</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">loadCreateImg()</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">observer</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">unobserve(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * rootMargin ä¸ºè§¦å‘æ‡’åŠ è½½çš„è·ç¦» é€šè¿‡ props ä¼ å…¥</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver/rootMargin</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       */</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> rootMargin</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">rootMargin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    )</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">observer</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ‰§è¡Œ æ‡’åŠ è½½</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">lazyCreateImg</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">():</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// IntersectionObserver å†…éƒ¨æ–¹æ³•ï¼Œéœ€è¦å°† dom èŠ‚ç‚¹ä¼ å…¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">observer()</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">observe(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>IntersectionObserver</code> æ¥å£å¯ä»¥åˆ¤æ–­ <code>dom</code> å…ƒç´ æ˜¯å¦è¿›å…¥å¯è§†åŒºåŸŸï¼Œé€šè¿‡å†…ç½®æ–¹æ³•åˆ¤æ–­è¿›å…¥å¯è§†åŒºåŸŸä¹‹åï¼Œæ‰§è¡Œçˆ¶ç±»çš„ <code>loadCreateImg</code> æ–¹æ³•è¿›è¡ŒåŠ è½½ï¼Œä»è€Œå®ç°æ‡’åŠ è½½ã€‚</p><h2 id="ğŸš¥-å¯¹å¤–æ¥å£" tabindex="-1">ğŸš¥ å¯¹å¤–æ¥å£ <a class="header-anchor" href="#ğŸš¥-å¯¹å¤–æ¥å£" aria-hidden="true">#</a></h2><p>å¯¹äº <code>Load</code> ç±»å’Œ <code>Lazy</code> ç±»ï¼Œ<code>Fighting Design</code> å¹¶æ²¡æœ‰ç›´æ¥æš´éœ²å‡ºå»æä¾›ä½¿ç”¨ï¼Œè€Œæ˜¯æš´éœ²å‡ºäº†ä¸€ä¸ªå…¨æ–°çš„ <code>loadImage</code> å‡½æ•°ï¼Œè®©å®ƒå»æ ¹æ®æ˜¯å¦ä¸ºæ‡’åŠ è½½è€Œå®ä¾‹åŒ–ä¸åŒçš„ç±»ï¼Œå†è°ƒç”¨åŠ è½½æ–¹æ³•ï¼š</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// å¯¼å‡ºå¯¹å¤–æ¥å£</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> loadImage </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">node</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">prop</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">emit</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">callback</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * å¦‚æœä¼ å…¥äº† lazy åˆ™æ‰§è¡Œæ‡’åŠ è½½ç±»</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * å¦åˆ™æ‰§è¡Œæ­£å¸¸åŠ è½½ç±»</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   */</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">prop</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lazy</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Lazy</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">prop</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">emit</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">callback</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lazy</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">lazyCreateImg</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">load</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Load</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">prop</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">emit</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">callback</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">load</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadCreateImg</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="ğŸ†-å®Œæ•´ä»£ç " tabindex="-1">ğŸ† å®Œæ•´ä»£ç  <a class="header-anchor" href="#ğŸ†-å®Œæ•´ä»£ç " aria-hidden="true">#</a></h2><p>å®Œæ•´ä»£ç ä»¥åŠæ›´å¤šç»†èŠ‚å¯å‚è€ƒ <a href="https://github.com/FightingDesign/fighting-design/blob/master/packages/fighting-design/_utils/load-image/index.ts" target="_blank" rel="noreferrer">load-image</a></p><h2 id="ğŸ’ª-å†™åœ¨æœ€å" tabindex="-1">ğŸ’ª å†™åœ¨æœ€å <a class="header-anchor" href="#ğŸ’ª-å†™åœ¨æœ€å" aria-hidden="true">#</a></h2><p>è¿™ç¯‡æ–‡ç« çš„å›¾ç‰‡åŠ è½½è®¾è®¡ï¼Œå–è‡ªæˆ‘å¸¦é¢†ç¤¾åŒºå°ä¼™ä¼´ä¸€èµ·åšçš„å¼€æº <code>vue3</code> ç»„ä»¶åº“ <a href="https://github.com/FightingDesign/fighting-design" target="_blank" rel="noreferrer">Fighting Design</a> ä¸­çš„éƒ¨åˆ†æºç ï¼Œæƒ³å‚ä¸å¼€æºç»„ä»¶åº“çš„å¼€å‘ä¹Ÿå¯ä»¥ç›´æ¥åŠ æˆ‘çš„å¾®ä¿¡ï¼š<code>VirgoTyh</code> ä¸€èµ·å…±åŒå­¦ä¹ ã€‚</p><p>æ¬¢è¿å¤§å®¶å¤šå¤š<code>ç‚¹èµ</code> <code>è¯„è®º</code> <code>Star</code>ï¼Œè¿˜æœ‰ä»€ä¹ˆéœ€è¦å®Œå–„çš„å¯ä»¥ç»™æˆ‘è¯„è®ºç•™è¨€ã€‚</p><p>ä¸è¦æƒ§æ€•å†™å‡ºä¸å®Œç¾çš„ä»£ç ï¼Œåªè¦åœ¨åç»­è¿­ä»£è¿‡ç¨‹ä¸­<code>è§æ‹›æ‹†æ‹›</code>ï¼Œä»£ç å°±ä¼šå˜å¾—è¶Šæ¥è¶Šå®Œå–„ï¼Œæ¡†æ¶ä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šå¥å£®ã€‚</p>`,51),e=[o];function t(c,r,y,F,D,i){return n(),a("div",null,e)}const d=s(p,[["render",t]]);export{A as __pageData,d as default};
