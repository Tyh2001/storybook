import{_ as s,o as a,c as n,a as l}from"./app.4f3fe047.js";const E=JSON.parse('{"title":"Linux 初级自动化打包部署","description":"","frontmatter":{},"headers":[{"level":2,"title":"🍦 前言","slug":"🍦-前言","link":"#🍦-前言","children":[]},{"level":2,"title":"🦚 配置服务器","slug":"🦚-配置服务器","link":"#🦚-配置服务器","children":[]},{"level":2,"title":"🚀 安装 node","slug":"🚀-安装-node","link":"#🚀-安装-node","children":[]},{"level":2,"title":"🛰️ 安装 Git","slug":"🛰️-安装-git","link":"#🛰️-安装-git","children":[]},{"level":2,"title":"🥕 安装 Pnpm","slug":"🥕-安装-pnpm","link":"#🥕-安装-pnpm","children":[]},{"level":2,"title":"🚧 基本命令","slug":"🚧-基本命令","link":"#🚧-基本命令","children":[]},{"level":2,"title":"⏳ 错误处理","slug":"⏳-错误处理","link":"#⏳-错误处理","children":[]},{"level":2,"title":"🐬 自动化打包部署","slug":"🐬-自动化打包部署","link":"#🐬-自动化打包部署","children":[]},{"level":2,"title":"🍀 写在最后","slug":"🍀-写在最后","link":"#🍀-写在最后","children":[]}],"relativePath":"article/article/18.md"}'),p={name:"article/article/18.md"},e=l(`<h1 id="linux-初级自动化打包部署" tabindex="-1">Linux 初级自动化打包部署 <a class="header-anchor" href="#linux-初级自动化打包部署" aria-hidden="true">#</a></h1><h2 id="🍦-前言" tabindex="-1">🍦 前言 <a class="header-anchor" href="#🍦-前言" aria-hidden="true">#</a></h2><p>大家好，我是<a href="https://github.com/Tyh2001" target="_blank" rel="noreferrer">田同学</a>，大家可以加我微信 <code>VirgoTyh</code> 一起共同学习。</p><p>近期开始学习了一些关于 <code>Linux</code> 相关的命令和新的可玩性的骚操作，一些命令笔记和遇到的问题，在这里记录一下，分享给大家~</p><h2 id="🦚-配置服务器" tabindex="-1">🦚 配置服务器 <a class="header-anchor" href="#🦚-配置服务器" aria-hidden="true">#</a></h2><p>配置服务器推荐使用 <a href="https://www.bt.cn/new/index.html" target="_blank" rel="noreferrer">宝塔</a> 进行配置，一键配置，非常方便快捷。</p><p>另外这里推荐两款服务器管理软件：</p><ul><li><a href="https://winscp.net/eng/docs/lang:chs" target="_blank" rel="noreferrer">WinSCP</a> WinSCP 是一个 Windows 环境下使用的 SSH 的开源图形化 SFTP 客户端。同时支持 SCP 协议。它的主要功能是在本地与远程计算机间安全地复制文件，并且可以直接编辑文件。</li><li><a href="https://www.xshell.com/zh/xshell/" target="_blank" rel="noreferrer">xShell</a> 这是业界最强大的 SSH 客户机。</li></ul><h2 id="🚀-安装-node" tabindex="-1">🚀 安装 node <a class="header-anchor" href="#🚀-安装-node" aria-hidden="true">#</a></h2><ol><li><p>首先需要在 <a href="http://kik.cn/download/" target="_blank" rel="noreferrer">node</a> 官网下载 <code>Linux 二进制文件 (x64)</code> 安装包</p></li><li><p>将下载的压缩包上传到 linux 服务器 <code>/usr/local</code> 目录下</p></li><li><p>将 <code>tar</code> 文件解压，执行命令：</p></li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-xvf</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">node-xxxx.tar</span></span>
<span class="line"></span></code></pre></div><ol start="4"><li>改文件夹的名字，改成 <code>node</code>，执行命令</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">mv</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">node-xxx</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">node</span></span>
<span class="line"></span></code></pre></div><ol start="5"><li>建立软连接，按序执行下面命令：</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/nodejs/bin/node</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/bin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/nodejs/bin/npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/bin</span></span>
<span class="line"></span></code></pre></div><ol start="6"><li>修改环境变量，执行命令：</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">export</span><span style="color:#BABED8;"> PATH</span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;">$PATH</span><span style="color:#C3E88D;">:/usr/local/node/bin</span></span>
<span class="line"></span></code></pre></div><ol start="7"><li>修改以后执行生效，执行命令：</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">source</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/etc/profile</span></span>
<span class="line"></span></code></pre></div><ol start="8"><li>测试：</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">node</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-v</span></span>
<span class="line"></span></code></pre></div><h2 id="🛰️-安装-git" tabindex="-1">🛰️ 安装 Git <a class="header-anchor" href="#🛰️-安装-git" aria-hidden="true">#</a></h2><p>在 <a href="https://git-scm.com/download/linux" target="_blank" rel="noreferrer">Git 官网</a> 提供了简单快捷的安装命令，一行命令即可实现安装。</p><h2 id="🥕-安装-pnpm" tabindex="-1">🥕 安装 Pnpm <a class="header-anchor" href="#🥕-安装-pnpm" aria-hidden="true">#</a></h2><p>安装了 <code>node</code> 之后，可以直接执行命令进行安装，但是安装完成之后需要重启终端，否则不生效。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">install</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">pnpm</span></span>
<span class="line"></span></code></pre></div><p>或者也可以通过 <a href="https://pnpm.io/zh/installation" target="_blank" rel="noreferrer">Pnpm 官网</a> 提供的脚本命令进行安装：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-fsSL</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">https://get.pnpm.io/install.sh</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">sh</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-</span></span>
<span class="line"></span></code></pre></div><h2 id="🚧-基本命令" tabindex="-1">🚧 基本命令 <a class="header-anchor" href="#🚧-基本命令" aria-hidden="true">#</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">ssh</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">name@ip</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 登陆服务器</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xxx</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 进入指定目录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">..</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 退到上一层目录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 进入主目录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 切换 root 用户</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">rm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-rf</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xxx/</span><span style="color:#BABED8;">*</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 删除 xxx 目录中的所有文件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xxx</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 新建文件夹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">touch</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xxx</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 新建文件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xxx</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 编辑/新建文件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xxx</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 编辑/新建文件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xxx</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 查看文件内容</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">ll</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 查看当前目录所有文件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-cvzf</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">打包的文件名.tgz</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">打包路径</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 打包 tgz 格式</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">zip</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-r</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">打包的文件名.zip</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">打包路径</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 打包 zip 格式</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">ifconfig</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 查看当前 ip</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">netstat</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-tnlp</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">grep</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">tcp</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 查看 TCP 监听端口</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">fuser</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-k</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">888</span><span style="color:#C3E88D;">/tcp</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 停止 888 端口</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">telnet</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xxx.x.xxx.xx</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">20038</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 检测指定地址的端口是否开启</span></span>
<span class="line"></span></code></pre></div><h2 id="⏳-错误处理" tabindex="-1">⏳ 错误处理 <a class="header-anchor" href="#⏳-错误处理" aria-hidden="true">#</a></h2><ul><li>错误 1</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">-bash:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">./tyh-blog.sh:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Permission</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">denied</span></span>
<span class="line"></span></code></pre></div><p>需要添加上可执行权限，执行命令：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">chmod</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">777</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xxx.sh</span></span>
<span class="line"></span></code></pre></div><ul><li>错误 2</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">rm:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">cannot</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">remove</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">blog/.user.ini</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Operation</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">not</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">permitted</span></span>
<span class="line"></span></code></pre></div><p>执行下面命令再删除：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">chattr</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">.user.ini</span></span>
<span class="line"></span></code></pre></div><h2 id="🐬-自动化打包部署" tabindex="-1">🐬 自动化打包部署 <a class="header-anchor" href="#🐬-自动化打包部署" aria-hidden="true">#</a></h2><p>安装了 <code>node</code> <code>git</code> <code>pnpm</code> 之后，就可以直接在服务器上拉取 github 仓库的代码，接下来安装依赖就可以在服务器上搭建一个和远程仓库一样的项目了。</p><p>接下来就可以编写一个 <code>shell</code> 脚本进行自动化执行，自动拉取最新代码，自动安装依赖，自动打包，新建 <code>xxx.sh</code> 文件，代码如下：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/xxx/xxxx/xxx</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 进入服务器仓库的地址</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 拉取最新代码</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 安装依赖</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">build</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 打包</span></span>
<span class="line"></span></code></pre></div><p>接下来每次需要更新网站的时候，就可以执行一下脚本，就可以实现自动化了，再使用宝塔工具将网站目录指向打包后的 <code>dist</code> 文件夹即可。</p><p>执行脚本命令：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">./xxx.sh</span></span>
<span class="line"></span></code></pre></div><h2 id="🍀-写在最后" tabindex="-1">🍀 写在最后 <a class="header-anchor" href="#🍀-写在最后" aria-hidden="true">#</a></h2><p>也欢迎加我微信共同学习：</p><ul><li>仓库：<code>https://github.com/Tyh2001/Linux-shell</code></li><li>微信：<code>VirgoTyh</code>（加好友邀请加入微信群）</li><li>Github: <code>https://github.com/Tyh2001</code></li></ul>`,49),o=[e];function t(c,r,i,y,B,d){return a(),n("div",null,o)}const D=s(p,[["render",t]]);export{E as __pageData,D as default};
